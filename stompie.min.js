angular.module("stompie",[]).factory("$stompie",["$rootScope","$timeout",function(a,b){"use strict";var c={},d=null,e=[],f={},g=function(){null!==d&&(f.client=new SockJS(d),f.stomp=Stomp.over(f.client),f.stomp.connect({},i,h))},h=function(){b(function(){g()},3e3)},i=function(b){a.$apply(function(){for(var a=0;a<e.length;a++)e[a](b)})};return c._connect=function(a,b){d=a,g(),e.push(b)},c.using=function(a,b){null===d||a!==d?c._connect(a,b):e.push(b)},c.disconnect=function(a){f.stomp.disconnect(a)},c.subscribe=function(b,c){return f.stomp.subscribe(b,function(b){var d=null;try{d=JSON.parse(b.body)}finally{a.$digest(c(d))}})},c.send=function(a,b,c){try{var d=JSON.stringify(b);c=c||{},f.stomp.send(a,c,d)}catch(e){throw e}return this},c}]);